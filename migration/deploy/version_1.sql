-- Deploy autour-du-bond-API:version_1 to pg

BEGIN;

CREATE TABLE "actor" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "first_name" TEXT NOT NULL,
  "last_name" TEXT NOT NULL,
  "picture_url" TEXT NOT NULL,
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);
CREATE TABLE "director" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "first_name" TEXT NOT NULL,
  "last_name" TEXT NOT NULL,
  "picture_url" TEXT NOT NULL,
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);

CREATE TABLE "movie" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "title" TEXT NOT NULL,
  "poster_url" TEXT NOT NULL,
  "actor_id" INTEGER NOT NULL REFERENCES "actor"("id") ON DELETE CASCADE,
  "director_id" INTEGER NOT NULL REFERENCES "director"("id") ON DELETE CASCADE,
  "year" INTEGER NOT NULL,
  "length" INTEGER NOT NULL,
  "cast" TEXT[],
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);

CREATE TABLE "episode" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "title" TEXT NOT NULL,
  "movie_id" INTEGER REFERENCES "movie"("id") ON DELETE CASCADE,
  "url" TEXT NOT NULL,
  "length" INTEGER NOT NULL,
  "abstract" TEXT NOT NULL,
  "description" TEXT NOT NULL,
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);

CREATE TABLE "podcaster" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "pseudo" INTEGER REFERENCES "movie"("id") ON DELETE CASCADE,
  "picture_url" TEXT NOT NULL,
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);

CREATE TABLE "episode_has_podcaster"(
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "episode_id" INTEGER NOT NULL REFERENCES "episode"("id") ON DELETE CASCADE,
  "podcaster_id" INTEGER NOT NULL REFERENCES "podcaster"("id") ON DELETE CASCADE,
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);

CREATE TABLE "rating"(
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "movie_id" INTEGER NOT NULL REFERENCES "movie"("id") ON DELETE CASCADE,
  "podcaster_id" INTEGER NOT NULL REFERENCES "podcaster"("id") ON DELETE CASCADE,
  "rating" INTEGER NOT NULL,
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  "updatedAt" TIMESTAMPTZ
);

COMMIT;
